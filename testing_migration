import paramiko
import json
import io

# WorkSpace details
WORKSPACE_IP = "10.42.80.249"  # Change to your WorkSpace IP
USERNAME = "your-username"  # WorkSpace username
PRIVATE_KEY = """-----BEGIN RSA PRIVATE KEY-----
YOUR_PRIVATE_KEY_HERE
-----END RSA PRIVATE KEY-----"""  # Paste your private key

def lambda_handler(event, context):
    try:
        # Create SSH client
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        # Load private key
        private_key = paramiko.RSAKey(file_obj=io.StringIO(PRIVATE_KEY))
        
        # Connect to WorkSpace
        ssh.connect(WORKSPACE_IP, username=USERNAME, pkey=private_key)

        # Run a test command
        stdin, stdout, stderr = ssh.exec_command("whoami")
        result = stdout.read().decode()

        ssh.close()

        return {
            "statusCode": 200,
            "body": json.dumps(f"SSH successful! Output: {result}")
        }

    except Exception as e:
        return {
            "statusCode": 500,
            "body": json.dumps(f"SSH failed: {str(e)}")
        }
