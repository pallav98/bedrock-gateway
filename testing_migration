import paramiko
import io
import json

WORKSPACE_IP = "10.42.80.249"  
USERNAME = "your-username"
PASSWORD = "your-password"  
PRIVATE_KEY = """-----BEGIN RSA PRIVATE KEY-----
YOUR_PRIVATE_KEY_HERE
-----END RSA PRIVATE KEY-----"""  

def lambda_handler(event, context):
    try:
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        private_key = paramiko.RSAKey(file_obj=io.StringIO(PRIVATE_KEY))

        # Try connecting with both key & password
        ssh.connect(WORKSPACE_IP, username=USERNAME, pkey=private_key, password=PASSWORD)

        stdin, stdout, stderr = ssh.exec_command("whoami")
        result = stdout.read().decode()

        ssh.close()
        return {"statusCode": 200, "body": json.dumps(f"SSH successful! Output: {result}")}

    except Exception as e:
        return {"statusCode": 500, "body": json.dumps(f"SSH failed: {str(e)}")}
